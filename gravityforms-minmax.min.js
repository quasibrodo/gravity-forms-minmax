gform.addFilter("gform_calculation_result",function(result,formulaField,formId,calcObj){if(formulaField.formula.indexOf("MIN(")>-1||formulaField.formula.indexOf("MAX(")>-1){let fieldFormula=calcObj.replaceFieldTags(formId,formulaField.formula,formulaField),pattern=/(MIN|MAX)\[([\d\s\)\(\*\\\+\-\.\,])+\s*\]/gi;fieldFormula=fieldFormula.replace(/MIN\(/gi,"MIN[").replace(/MAX\(/gi,"MAX[");for(var regex=/(MIN\[|MAX\[)/gi,result,fieldFormulaIndices=[];result=regex.exec(fieldFormula);)fieldFormulaIndices.push(result.index+3);for(var t=0;t<fieldFormulaIndices.length;t++){let e=0,l=0;for(var k=fieldFormulaIndices[t];k<fieldFormula.length;k++)if("["===fieldFormula[k]||"("===fieldFormula[k]?e++:")"===fieldFormula[k]&&l++,e==l&&0!=e){fieldFormula=fieldFormula.substr(0,k)+"]"+fieldFormula.substr(k+1);break}}for(;fieldFormula.indexOf("MIN[")>-1||fieldFormula.indexOf("MAX[")>-1;){let matches=fieldFormula.match(pattern),replaces=[];for(let i in matches){let components=/(MIN|MAX)\[([\d\s\)\(\*\\\+\-\.\,])+\s*\]/gi.exec(matches[i]),values=components[0].replace("MAX[","").replace("MIN[","").replace("]","").split(",").map((value,index,array)=>parseFloat(eval(value.trim())));"MIN"==components[1]&&replaces.push([matches[i],Math.min(...values)]),"MAX"==components[1]&&replaces.push([matches[i],Math.max(...values)])}for(let e in replaces)fieldFormula=fieldFormula.replace(replaces[e][0],replaces[e][1]);fieldFormula=fieldFormula.replace(/[^0-9\s\n\r\+\-\*\/\^\(\)\.](MIN|MAX)/g,"")}result=eval(fieldFormula)}return result});
